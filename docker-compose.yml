services:
  backend:
    build: ./backend
    ports:
      - "8080:8080"
    environment:
      - TRANSMISSION_URL=http://transmission:9091/transmission/rpc
      - TRANSMISSION_DOWNLOAD_DIR=/downloads
      - HLS_SEGMENT_SECONDS=20
    volumes:
      - ${MEDIA_DIR:-./videos}:/app/videos
      - hls_data:/app/hls
      - mp4_data:/app/mp4
    depends_on:
      - transmission

  frontend:
    build: ./frontend
    ports:
      - "3000:80"
    depends_on:
      - backend

  transmission:
    build: ./transmission
    command: ["transmission-daemon", "-f", "-g", "/config", "-w", "/downloads"]
    ports:
      - "9091:9091"
      - "51413:51413"
      - "51413:51413/udp"
    volumes:
      - ${MEDIA_DIR:-./videos}:/downloads
      - transmission_config:/config
      - ./transmission/settings.json:/config/settings.json

volumes:
  hls_data:
  mp4_data:
  transmission_config:
